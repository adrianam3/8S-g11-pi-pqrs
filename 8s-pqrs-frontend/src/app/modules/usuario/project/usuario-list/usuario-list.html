<div class="card card-w-title" style="display:flex;justify-content:space-between;align-items:center;">
  <div style="display:flex;align-items:center;">
    <i class="pi pi-user"></i>
    <span style="font-size:15px;margin-left:5px;"><b>USUARIOS</b></span>
  </div>
  <div>
    <button pButton label="Nuevo Usuario" icon="pi pi-plus" severity="success" [raised]="true" (click)="openNew()"></button>
  </div>
</div>

<div class="card card-w-title">
  <p-table #dt [value]="usuariosAll" dataKey="idUsuario" [rows]="10" [loading]="loading"
           [rowHover]="true" [showGridlines]="true" [paginator]="true"
           [globalFilterFields]="['usuario','nombreCompleto','descRol','email','agenciaNombre','fechaCreacion','descEstado']"
           [tableStyle]="{'min-width':'75rem'}" [showCurrentPageReport]="true"
           currentPageReportTemplate="Mostrando de {first} a {last} de {totalRecords} registros.">

    <ng-template pTemplate="caption">
      <div class="flex justify-content-between flex-column sm:flex-row">
        <button pButton label="Borrar Filtros" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="showFilter()"></button>
        <p-iconfield iconPosition="left" class="ml-auto">
          <p-inputicon><i class="pi pi-search"></i></p-inputicon>
          <input pInputText type="text" (input)="onGlobalFilter(dt, $event)" placeholder="Buscar" />
        </p-iconfield>
      </div>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th>Usuario</th>
        <th>Nombre</th>
        <th>E-mail</th>
        <th>Rol</th>
        <th>Agencia</th>
        <th>Fecha Creación</th>
        <th>Estado</th>
        <th class="text-center" style="width:8rem">Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-r>
      <tr>
        <td class="text-center">{{ r.usuario }}</td>
        <td class="text-center">{{ r.nombreCompleto }}</td>
        <td class="text-center">{{ r.email }}</td>
        <td class="text-center">{{ r.descRol }}</td>
        <td class="text-center">{{ r.agenciaNombre }}</td>
        <td class="text-center">{{ r.fechaCreacion }}</td>
        <td class="text-center">{{ r.descEstado }}</td>
        <td class="text-center">
          <button pButton icon="pi pi-pencil" [rounded]="true" [outlined]="true" severity="success"
                  class="mr-2" pTooltip="Editar" (click)="openEdit(r)"></button>
          <button pButton icon="pi pi-trash" [rounded]="true" [outlined]="true" severity="danger"
                  pTooltip="Eliminar" (click)="askDelete(r)"></button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr><td colspan="8" class="text-center">Sin registros</td></tr>
    </ng-template>
  </p-table>
</div>

<!-- Dialogo Crear/Editar -->
<p-dialog [(visible)]="showDialog" [modal]="true" [style]="{width:'560px'}" [draggable]="false" [resizable]="false">
  <ng-template pTemplate="header">
    <div class="flex align-items-center">
      <i class="pi pi-user-edit mr-2"></i>
      <span class="font-semibold">{{ dialogTitle }}</span>
    </div>
  </ng-template>

  <div class="grid formgrid">
    <div class="col-12 md:col-6">
      <label class="block mb-2">Usuario *</label>
      <input pInputText type="text" [(ngModel)]="form.usuario">
    </div>

    <div class="col-12 md:col-6" *ngIf="!isEdit">
      <label class="block mb-2">Contraseña *</label>
      <input pPassword [feedback]="false" [(ngModel)]="form.password" />
    </div>

    <div class="col-12">
      <label class="block mb-2">Descripción</label>
      <input pInputText type="text" [(ngModel)]="form.descripcion">
    </div>

    <div class="col-12 md:col-6">
      <label class="block mb-2">Persona *</label>
      <p-select [options]="personasOpts" [(ngModel)]="form.idPersona" optionLabel="label" optionValue="value"
                  placeholder="Seleccione" [filter]="true"></p-select>
    </div>

    <div class="col-12 md:col-6">
      <label class="block mb-2">Rol *</label>
      <p-select [options]="rolesOpts" [(ngModel)]="form.idRol" optionLabel="label" optionValue="value"
                  placeholder="Seleccione" [filter]="true"></p-select>
    </div>

    <div class="col-12 md:col-6">
      <label class="block mb-2">Agencia *</label>
      <p-select [options]="agenciasOpts" [(ngModel)]="form.idAgencia" optionLabel="label" optionValue="value"
                  placeholder="Seleccione" [filter]="true"></p-select>
    </div>

    <div class="col-12 md:col-6">
      <label class="block mb-2">Estado</label>
      <select class="p-inputtext p-component w-full" [(ngModel)]="form.estado">
        <option [ngValue]="1">Activo</option>
        <option [ngValue]="0">Inactivo</option>
      </select>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button pButton label="Cancelar" class="p-button-text" (click)="closeDialog()"></button>
    <button pButton label="Guardar" icon="pi pi-check" (click)="save()"></button>
  </ng-template>
</p-dialog>

<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>
